"undefined"!=typeof window&&document.addEventListener("DOMContentLoaded",(()=>{const t=document.querySelectorAll(".add-button"),e=document.getElementById("cartSidebar"),n=document.getElementById("cartItems"),a=document.getElementById("cartTotal"),i=document.getElementById("closeCart"),o=document.getElementById("payButton"),c=document.getElementById("mainContent");let d=JSON.parse(localStorage.getItem("cart"))||[];function s(t,e){const n=d.find((e=>e.id===t));n&&(n.quantity+=e,n.quantity<=0?d=d.filter((e=>e.id!==t)):n.subtotal=n.quantity*n.price,localStorage.setItem("cart",JSON.stringify(d)),r())}function r(){n.innerHTML="";let t=0;d.forEach((e=>{const a=document.createElement("div");a.classList.add("cart-item"),a.innerHTML=`\n                      <img src="${e.img}.jpg" alt="${e.name}">\n                      <div>\n                          <h4>${e.name}</h4>\n                          <div class="quantity-controls">\n                              <button class="decrease" data-id="${e.id}">-</button>\n                              <span>Cantidad: ${e.quantity}</span>\n                              <button class="increase" data-id="${e.id}">+</button>\n                          </div>\n                          <p>Subtotal: $${e.subtotal.toFixed(2)}</p>\n                      </div>\n                  `,n.appendChild(a),t+=e.subtotal})),a.innerHTML=`Total: $${t.toFixed(2)}`;const e=document.querySelectorAll(".increase"),i=document.querySelectorAll(".decrease");e.forEach((t=>{t.addEventListener("click",(()=>{s(parseInt(t.getAttribute("data-id"),10),1)}))})),i.forEach((t=>{t.addEventListener("click",(()=>{s(parseInt(t.getAttribute("data-id"),10),-1)}))}))}t.forEach((t=>{t.addEventListener("click",(async()=>{const n=parseInt(t.getAttribute("data-id"),10);!function(t){const e=d.find((e=>e.id===t.id));e?(e.quantity++,e.subtotal=e.quantity*e.price):d.push({...t,quantity:1,subtotal:t.price});localStorage.setItem("cart",JSON.stringify(d)),r()}(await async function(t){const e=await fetch(`getItemDetails.php?id=${t}`);return await e.json()}(n)),e.classList.add("open"),c.classList.add("shifted")}))})),i.addEventListener("click",(()=>{e.classList.remove("open"),c.classList.remove("shifted")})),o.addEventListener("click",(async()=>{await async function(){(await fetch("processPayment.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)})).ok?(alert("Pago realizado con Ã©xito"),d=[],localStorage.setItem("cart",JSON.stringify(d)),r(),e.classList.remove("open"),c.classList.remove("shifted")):alert("Error al procesar el pago")}()})),r()}));